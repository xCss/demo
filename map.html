<!DOCTYPE html>  
<html>  
<head>  
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<meta name="author" content="xCss xioveliu@gmail.com">
<title>地图</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta content="telephone=no" name="format-detection"> 
<style>
*{box-sizing: border-box;-webkit-box-sizing: border-box;margin:0 auto;padding:0;}
html,body{height:100%;overflow:hidden;}
#container{height:100%;}
</style>
<script src='./assets/zepto.min.js'></script>
<script src='//api.map.baidu.com/api?v=3.0&ak=Rjs1Sww9UtZdZ4NwC6jCXUPRWiOYavgX'></script>
<script type="text/javascript">  
    var AK = 'Rjs1Sww9UtZdZ4NwC6jCXUPRWiOYavgX';
    $(function(){
        var map = new BMap.Map("container");            // 创建地图实例  
        var point = new BMap.Point(116.404, 39.915);    // 创建点坐标  
        map.centerAndZoom(point, 10);                   // 初始化地图，设置中心点坐标和地图级别 
        map.enableScrollWheelZoom(true);                // 开启鼠标滚轮缩放 	
        map.addControl(new BMap.ScaleControl({anchor: BMAP_ANCHOR_BOTTOM_LEFT}));       // 左下角，添加比例尺
        map.addControl(new BMap.NavigationControl({anchor: BMAP_ANCHOR_BOTTOM_RIGHT})); //右下角，添加默认缩放平移控件

        var myCity = new BMap.LocalCity();
        myCity.get(function(ret){
            var cityName = ret && ret.name || '';
            if(cityName) map.setCenter(cityName);
            else ip2location()
        });  

        function ip2location(){
            $.get('//api.map.baidu.com/location/ip?ak='+AK+'&coor=bd09ll',function(ret){
                if(ret.status==0){
                    map.panTo(ret.content.point)
                }else{
                    var geolocation = new BMap.Geolocation();
                    // 开启SDK辅助定位
                    geolocation.enableSDKLocation();
                    geolocation.getCurrentPosition(function(r){
                        if(this.getStatus() == BMAP_STATUS_SUCCESS){
                            map.panTo(r.point);
                        }    
                    });
                }
            },'json')
        }
        $.get('http://www.fomsun.com:34567/home/temple/templelist',function(ret){
            console.log(ret)
        },'json')
        
        var sContent =
        "<h4 style='margin:0 0 5px 0;padding:0.2em 0'><a href='http://baidu.com'>天安门</a></h4>" + 
        "<p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em'>天安门坐落在中国北京市中心,故宫的南侧,与天安门广场隔长安街相望,是清朝皇城的大门...</p>" + 
        "</div>";
        var marker = new BMap.Marker(point);
        var infoWindow = new BMap.InfoWindow(sContent,{width:0,height:0});  // 创建信息窗口对象
        map.addOverlay(marker);
        marker.addEventListener("click", function(){          
            this.openInfoWindow(infoWindow);
            //图片加载完毕重绘infowindow
            // document.getElementById('imgDemo').onload = function (){
            //     infoWindow.redraw();   //防止在网速较慢，图片未加载时，生成的信息框高度比图片的总高度小，导致图片部分被隐藏
            // }
        });
    })
</script>  
</head>  
<body>
    <div id="container"></div> 
</body>  
</html> 